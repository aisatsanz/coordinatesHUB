# Автоматизированная геолокация по изображениям

## Описание проекта
Цель проекта — автоматическое определение географических координат объектов (зданий, улиц, инфраструктуры) по фотографии или видеокадру.  
Решение ориентировано на задачи городских сервисов:  
- инвентаризация зданий,  
- мониторинг инфраструктуры и застройки,  
- навигация,  
- выявление нелегальных построек.  


## Важная помарка
Мы не успели собрать сервис полностью поэтому тут скрипт обучения и inference.ipynb где на вход берется папка с images и табличка с img_path, lat, lon и на выход табличка img_path, gt_lat, gt_lon, pred_lat, pred_lon и ошибка в метрах
Мы провели объемный ресерч и надеемся на снисходительность! Средняя ошибка ~5км
---

## Подход
Мы исследовали различные стратегии геолокации и пришли к гибридному решению:  
1. **Классификация по глобальной сетке (H3)** — выбор региона на уровне района/квартала.  
2. **Локальная регрессия смещения (ENU-координаты)** — уточнение внутри выбранной ячейки.  
3. **Мощный визуальный backbone (CLIP, DINOv2)** — извлечение устойчивых признаков из изображений.  
4. **Мультимодальность** — использование метаданных (ID камеры, время суток, OCR-подсказки).  
5. **Мультигипотезный вывод (top-K)** — формирование нескольких кандидатов координат и оценка их уверенности.  

Такой coarse-to-fine подход соответствует современным исследованиям и показывает стабильные результаты.

---

## Исследование и эксперименты
- **Сегментация зданий**  
  Использован Mask2Former, показал устойчивое выделение зданий даже на «грязных» данных. Это улучшает точность локализации и закладывает основу для интеграции картографической информации (например, OSM).  

- **Архитектурные варианты**  
  - *Базовый регрессор* (ResNet → координаты) — дал «нулевую линию» качества.  
  - *CvelsialArch* (EfficientNet + ResNet-terrain + geo-reasoner) — лучший результат для Москвы/МО, добавляет контекст сцены и оценку уверенности.  
  - *GPS-RetinaNet + трекер* — рассмотрен как перспективное направление для мультикадровых данных.  

- **Отброшенные подходы**  
  - Прямая регрессия координат (нестабильность, большие ошибки).  
  - Контрастивные прототипы (неустойчивы на малых данных).  
  - OCR-first (адресные таблички встречаются редко).  
  - Чистый kNN по эмбеддингам (не обобщается на новые районы).  

---

## Работа с данными
- Проведена валидация выгрузок и очистка шумов.  
- Построен нулевой baseline («центр Москвы»).  
- Сформирован репродуцируемый пайплайн для оценки разных моделей.  
- Проверены десятки выгрузок, проведена визуальная инспекция сцен.  

---

## Результаты
- Модель успешно локализует объекты с медианной ошибкой в пределах сотен метров, что на порядок лучше простых baseline-методов.  
- Система демонстрирует устойчивость на разнородных данных (день/ночь, разные камеры).  
- Масштабируемость: решение может работать в реальном времени на тысячах камер.  

---

## Будущее развитие
- Контрастивное обучение эмбеддингов (в духе PIGEON).  
- Интеграция OCR как вспомогательного канала.  
- Использование последовательностей кадров (мультикадровый трекинг).  
- Подключение картографических данных (OpenStreetMap).  
- Оптимизация для кластеров GPU (A100/H100) с обработкой видеопотоков в реальном времени.  

---

## Заключение
Мы разработали систему автоматизированной геолокации, которая сочетает лучшие практики машинного обучения и географических априори.  
Она масштабируема, объяснима и применима в городских сервисах для автоматического мониторинга и анализа изображений.
